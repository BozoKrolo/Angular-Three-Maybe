import { Directive, EventEmitter, Host, inject, Injectable, Input, Output } from '@angular/core';
import { ThAnimationLoopService } from '../renderer/th-animation-loop.service';
import { isObserved } from '../util';
import { createLazyObject3DProxy } from './LazyObject3dProxy';
import { ThLoader } from './ThLoaderBase';
import * as i0 from "@angular/core";
export class ThAsyncLoaderService extends ThLoader {
    load(...args) {
        const loader = this.createLoaderInstance();
        return loader.loadAsync(...args);
    }
}
ThAsyncLoaderService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.1.1", ngImport: i0, type: ThAsyncLoaderService, deps: null, target: i0.ɵɵFactoryTarget.Injectable });
ThAsyncLoaderService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.1.1", ngImport: i0, type: ThAsyncLoaderService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.1.1", ngImport: i0, type: ThAsyncLoaderService, decorators: [{
            type: Injectable
        }] });
export class ThAsyncLoaderBasePipe {
    constructor() {
        this.animationLoop = inject(ThAnimationLoopService);
    }
    transform(...args) {
        return this.service.load(...args).then((response) => {
            this.animationLoop.requestAnimationFrame();
            return response;
        });
    }
}
export class ThAsyncLoaderBaseDirective {
    set url(url) {
        this._url = url;
        this.load();
    }
    get url() {
        return this._url;
    }
    get onLoaded() {
        if (!this.onLoaded$) {
            this.onLoaded$ = new EventEmitter();
        }
        return this.onLoaded$;
    }
    get onProgress() {
        if (!this.onProgress$) {
            this.onProgress$ = new EventEmitter();
        }
        return this.onProgress$;
    }
    constructor(host, zone) {
        this.host = host;
        this.zone = zone;
        this.initialized = false;
        this.animationLoop = inject(ThAnimationLoopService);
        this.proxy = createLazyObject3DProxy();
        host.objRef = this.proxy;
    }
    ngOnInit() {
        this.initialized = true;
        this.load();
        // this.zone.runOutsideAngular(() => );
    }
    async load() {
        if (!this.initialized) {
            return;
        }
        if (this._url === undefined) {
            throw new Error('missing url');
        }
        if (!this.proxy) {
            return;
        }
        const url = this._url;
        const onProgress = isObserved(this.onProgress$)
            ? (progress) => {
                this.zone.run(() => {
                    this.onProgress$?.next(progress);
                });
            }
            : undefined;
        const result = await this.zone.runOutsideAngular(() => this.service.load(url, onProgress));
        this.animationLoop.requestAnimationFrame();
        this.proxy.objRef = this.getRefFromResponse(result);
        // add the new object to the parent and
        // emit a loaded event directly on the three.js object and on objRef$
        this.host.objRef = this.proxy;
        if (this.onLoaded$ && result !== undefined) {
            this.zone.run(() => this.onLoaded$?.next(result));
        }
    }
}
ThAsyncLoaderBaseDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.1.1", ngImport: i0, type: ThAsyncLoaderBaseDirective, deps: "invalid", target: i0.ɵɵFactoryTarget.Directive });
ThAsyncLoaderBaseDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "15.1.1", type: ThAsyncLoaderBaseDirective, inputs: { url: "url" }, outputs: { onLoaded: "onLoaded", onProgress: "onProgress" }, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.1.1", ngImport: i0, type: ThAsyncLoaderBaseDirective, decorators: [{
            type: Directive,
            args: [{}]
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Host
                }] }, { type: i0.NgZone }]; }, propDecorators: { url: [{
                type: Input
            }], onLoaded: [{
                type: Output
            }], onProgress: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGhBc3luY0xvYWRlckJhc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtdGhyZWUvc3JjL2xpYi9sb2FkZXJzL1RoQXN5bmNMb2FkZXJCYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsWUFBWSxFQUNaLElBQUksRUFDSixNQUFNLEVBQ04sVUFBVSxFQUNWLEtBQUssRUFHTCxNQUFNLEVBR1AsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDL0UsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUNyQyxPQUFPLEVBQUUsdUJBQXVCLEVBQXFCLE1BQU0scUJBQXFCLENBQUM7QUFDakYsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDOztBQVExQyxNQUFNLE9BQWdCLG9CQUE0QyxTQUFRLFFBQVc7SUFDNUUsSUFBSSxDQUFDLEdBQUcsSUFBZ0M7UUFDN0MsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7UUFDM0MsT0FBTyxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUksSUFBNkMsQ0FBK0IsQ0FBQztJQUMzRyxDQUFDOztpSEFKbUIsb0JBQW9CO3FIQUFwQixvQkFBb0I7MkZBQXBCLG9CQUFvQjtrQkFEekMsVUFBVTs7QUFRWCxNQUFNLE9BQWdCLHFCQUFxQjtJQUd6QztRQURRLGtCQUFhLEdBQUcsTUFBTSxDQUFDLHNCQUFzQixDQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVULFNBQVMsQ0FBQyxHQUFHLElBQWdDO1FBQ2xELE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRTtZQUNsRCxJQUFJLENBQUMsYUFBYSxDQUFDLHFC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LENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztTQUNuRDtJQUNILENBQUM7O3VIQXJGbUIsMEJBQTBCOzJHQUExQiwwQkFBMEI7MkZBQTFCLDBCQUEwQjtrQkFEL0MsU0FBUzttQkFBQyxFQUFFOzswQkF1Q0UsSUFBSTtpRUF2QmIsR0FBRztzQkFETixLQUFLO2dCQVVRLFFBQVE7c0JBQXJCLE1BQU07Z0JBT08sVUFBVTtzQkFBdkIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIERpcmVjdGl2ZSxcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0LFxuICBpbmplY3QsXG4gIEluamVjdGFibGUsXG4gIElucHV0LFxuICBOZ1pvbmUsXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBQaXBlVHJhbnNmb3JtLFxuICBUeXBlXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTG9hZGVyIH0gZnJvbSAndGhyZWUnO1xuaW1wb3J0IHsgVGhBbmltYXRpb25Mb29wU2VydmljZSB9IGZyb20gJy4uL3JlbmRlcmVyL3RoLWFuaW1hdGlvbi1sb29wLnNlcnZpY2UnO1xuaW1wb3J0IHsgaXNPYnNlcnZlZCB9IGZyb20gJy4uL3V0aWwnO1xuaW1wb3J0IHsgY3JlYXRlTGF6eU9iamVjdDNEUHJveHksIExhenlPYmplY3QzRFByb3h5IH0gZnJvbSAnLi9MYXp5T2JqZWN0M2RQcm94eSc7XG5pbXBvcnQgeyBUaExvYWRlciB9IGZyb20gJy4vVGhMb2FkZXJCYXNlJztcblxuaW50ZXJmYWNlIEFzeW5jTG9hZGVyPFQgPSBhbnk+IGV4dGVuZHMgTG9hZGVyIHtcbiAgbG9hZEFzeW5jKHVybDogc3RyaW5nLCBvblByb2dyZXNzPzogKGV2ZW50OiBQcm9ncmVzc0V2ZW50KSA9PiB2b2lkKTogUHJvbWlzZTxUPjtcbn1cbnR5cGUgQXdhaXRlZDxUPiA9IFQgZXh0ZW5kcyBQcm9taXNlTGlrZTxpbmZlciBVPiA/IFUgOiBUO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgVGhBc3luY0xvYWRlclNlcnZpY2U8VCBleHRlbmRzIEFzeW5jTG9hZGVyPiBleHRlbmRzIFRoTG9hZGVyPFQ+IHtcbiAgcHVibGljIGxvYWQoLi4uYXJnczogUGFyYW1ldGVyczxUWydsb2FkQXN5bmMnXT4pOiBSZXR1cm5UeXBlPFRbJ2xvYWRBc3luYyddPiB7XG4gICAgY29uc3QgbG9hZGVyID0gdGhpcy5jcmVhdGVMb2FkZXJJbnN0YW5jZSgpO1xuICAgIHJldHVybiBsb2FkZXIubG9hZEFzeW5jKC4uLihhcmdzIGFzIFBhcmFtZXRlcnM8QXN5bmNMb2FkZXJbJ2xvYWRBc3luYyddPikpIGFzIFJldHVyblR5cGU8VFsnbG9hZEFzeW5jJ10+O1xuICB9XG59XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBUaEFzeW5jTG9hZGVyQmFzZVBpcGU8VCBleHRlbmRzIEFzeW5jTG9hZGVyPiBpbXBsZW1lbnRzIFBpcGVUcmFuc2Zvcm0ge1xuICBwcm90ZWN0ZWQgYWJzdHJhY3Qgc2VydmljZTogVGhBc3luY0xvYWRlclNlcnZpY2U8VD47XG4gIHByaXZhdGUgYW5pbWF0aW9uTG9vcCA9IGluamVjdChUaEFuaW1hdGlvbkxvb3BTZXJ2aWNlKTtcbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIHB1YmxpYyB0cmFuc2Zvcm0oLi4uYXJnczogUGFyYW1ldGVyczxUWydsb2FkQXN5bmMnXT4pIHtcbiAgICByZXR1cm4gdGhpcy5zZXJ2aWNlLmxvYWQoLi4uYXJncykudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgIHRoaXMuYW5pbWF0aW9uTG9vcC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKTtcbiAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9KTtcbiAgfVxufVxuXG5ARGlyZWN0aXZlKHt9KVxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFRoQXN5bmNMb2FkZXJCYXNlRGlyZWN0aXZlPFQgZXh0ZW5kcyBBc3luY0xvYWRlcj4gaW1wbGVtZW50cyBPbkluaXQge1xuICBwcm90ZWN0ZWQgYWJzdHJhY3Qgc2VydmljZTogVGhBc3luY0xvYWRlclNlcnZpY2U8VD47XG5cbiAgcHJvdGVjdGVkIGFic3RyYWN0IGdldFJlZkZyb21SZXNwb25zZShyZXNwb25zZTogQXdhaXRlZDxSZXR1cm5UeXBlPFRbJ2xvYWRBc3luYyddPj4pOiBhbnk7XG5cbiAgcHJvdGVjdGVkIGluaXRpYWxpemVkID0gZmFsc2U7XG4gIHByb3RlY3RlZCBfdXJsPzogUGFyYW1ldGVyczxUWydsb2FkQXN5bmMnXT5bMF07XG5cbiAgcHJvdGVjdGVkIG9uTG9hZGVkJD86IEV2ZW50RW1pdHRlcjxBd2FpdGVkPFJldHVyblR5cGU8VFsnbG9hZEFzeW5jJ10+Pj47XG4gIHByb3RlY3RlZCBvblByb2dyZXNzJD86IEV2ZW50RW1pdHRlcjxQcm9ncmVzc0V2ZW50PjtcbiAgcHJvdGVjdGVkIHByb3h5OiBMYXp5T2JqZWN0M0RQcm94eTtcblxuICBwcm90ZWN0ZWQgYW5pbWF0aW9uTG9vcCA9IGluamVjdChUaEFuaW1hdGlvbkxvb3BTZXJ2aWNlKTtcblxuICBASW5wdXQoKVxuICBzZXQgdXJsKHVybDogUGFyYW1ldGVyczxUWydsb2FkQXN5bmMnXT5bMF0gfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLl91cmwgPSB1cmw7XG4gICAgdGhpcy5sb2FkKCk7XG4gIH1cblxuICBnZXQgdXJsKCkge1xuICAgIHJldHVybiB0aGlzLl91cmw7XG4gIH1cblxuICBAT3V0cHV0KCkgZ2V0IG9uTG9hZGVkKCkge1xuICAgIGlmICghdGhpcy5vbkxvYWRlZCQpIHtcbiAgICAgIHRoaXMub25Mb2FkZWQkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5vbkxvYWRlZCQ7XG4gIH1cblxuICBAT3V0cHV0KCkgZ2V0IG9uUHJvZ3Jlc3MoKSB7XG4gICAgaWYgKCF0aGlzLm9uUHJvZ3Jlc3MkKSB7XG4gICAgICB0aGlzLm9uUHJvZ3Jlc3MkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5vblByb2dyZXNzJDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKEBIb3N0KCkgcHJvdGVjdGVkIGhvc3Q6IHsgb2JqUmVmOiBhbnkgfSwgcHJvdGVjdGVkIHpvbmU6IE5nWm9uZSkge1xuICAgIHRoaXMucHJveHkgPSBjcmVhdGVMYXp5T2JqZWN0M0RQcm94eSgpO1xuICAgIGhvc3Qub2JqUmVmID0gdGhpcy5wcm94eTtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgIHRoaXMubG9hZCgpO1xuICAgIC8vIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiApO1xuICB9XG5cbiAgcHJvdGVjdGVkIGFzeW5jIGxvYWQoKSB7XG4gICAgaWYgKCF0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX3VybCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ21pc3NpbmcgdXJsJyk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLnByb3h5KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgdXJsID0gdGhpcy5fdXJsO1xuXG4gICAgY29uc3Qgb25Qcm9ncmVzcyA9IGlzT2JzZXJ2ZWQodGhpcy5vblByb2dyZXNzJClcbiAgICAgID8gKHByb2dyZXNzOiBQcm9ncmVzc0V2ZW50PEV2ZW50VGFyZ2V0PikgPT4ge1xuICAgICAgICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vblByb2dyZXNzJD8ubmV4dChwcm9ncmVzcyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIDogdW5kZWZpbmVkO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+XG4gICAgICAodGhpcy5zZXJ2aWNlIGFzIFRoQXN5bmNMb2FkZXJTZXJ2aWNlPEFzeW5jTG9hZGVyPikubG9hZCh1cmwsIG9uUHJvZ3Jlc3MpXG4gICAgKTtcblxuICAgIHRoaXMuYW5pbWF0aW9uTG9vcC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKTtcbiAgICB0aGlzLnByb3h5Lm9ialJlZiA9IHRoaXMuZ2V0UmVmRnJvbVJlc3BvbnNlKHJlc3VsdCk7XG4gICAgLy8gYWRkIHRoZSBuZXcgb2JqZWN0IHRvIHRoZSBwYXJlbnQgYW5kXG4gICAgLy8gZW1pdCBhIGxvYWRlZCBldmVudCBkaXJlY3RseSBvbiB0aGUgdGhyZWUuanMgb2JqZWN0IGFuZCBvbiBvYmpSZWYkXG4gICAgdGhpcy5ob3N0Lm9ialJlZiA9IHRoaXMucHJveHk7XG5cbiAgICBpZiAodGhpcy5vbkxvYWRlZCQgJiYgcmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuem9uZS5ydW4oKCkgPT4gdGhpcy5vbkxvYWRlZCQ/Lm5leHQocmVzdWx0KSk7XG4gICAgfVxuICB9XG59XG4iXX0=