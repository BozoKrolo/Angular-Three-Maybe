import { ChangeDetectionStrategy, Component, ContentChildren, forwardRef, Inject, Input, isDevMode, ViewChild } from '@angular/core';
import { Raycaster } from 'three';
import { RAYCASTER, RaycasterService } from './events/raycaster.service';
import { ThObject3D } from './generated/ThObject3D';
import { ThAnimationLoopService } from './renderer/th-animation-loop.service';
import { ThEngineService } from './ThEngine.service';
import { ThView } from './ThView';
import * as i0 from "@angular/core";
import * as i1 from "./ThEngine.service";
import * as i2 from "./renderer/th-animation-loop.service";
import * as i3 from "@angular/common";
import * as i4 from "./events/raycaster.service";
// eslint-disable-next-line @angular-eslint/component-class-suffix
export class ThCanvas extends ThView {
    get obj() {
        return this;
    }
    set views(viewList) {
        viewList.forEach((v) => this.engServ.addView(v));
    }
    set rendererCanvas(canvas) {
        if (!canvas) {
            return;
        }
        this._rendererCanvas = canvas;
        canvas.nativeElement.id += this.nid;
    }
    get rendererCanvas() {
        return this._rendererCanvas;
    }
    constructor(engServ, animationLoop, raycaster) {
        super(engServ, raycaster);
        this.engServ = engServ;
        this.animationLoop = animationLoop;
        this.raycaster = raycaster;
        this.isDevMode = isDevMode;
        this.nid = ThCanvas.instanceCnt++;
        /**
         * if true does not use the ThCanvas as view
         * this is esepcially usefull if you have multiple views
         * and want to iterate over all of them with *ngFor
         * use statically (before ngOnInit is triggered)
         */
        this.disableDefaultView = false;
    }
    ngAfterContentChecked() {
        this.animationLoop.requestAnimationFrame();
    }
    ngAfterViewInit() {
        this.animationLoop.requestAnimationFrame();
    }
    ngOnInit() {
        this.applyRendererParameters();
        super.ngOnInit();
        if (!this.disableDefaultView) {
            this.engServ.addView(this);
        }
    }
    applyRendererParameters() {
        if (!this.rendererCanvas) {
            throw new Error('Missing Canvas');
        }
        this.engServ.setRenderer({ ...this.rendererParameters, domElement: this.rendererCanvas.nativeElement });
    }
}
ThCanvas.instanceCnt = 0;
ThCanvas.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.1.1", ngImport: i0, type: ThCanvas, deps: [{ token: i1.ThEngineService }, { token: i2.ThAnimationLoopService }, { token: forwardRef(() => RaycasterService) }], target: i0.ɵɵFactoryTarget.Component });
ThCanvas.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.1.1", type: ThCanvas, selector: "th-canvas", inputs: { rendererParameters: "rendererParameters", disableDefaultView: "disableDefaultView" }, providers: [
        { provide: ThObject3D, useExisting: forwardRef(() => ThCanvas) },
        ThEngineService,
        ThAnimationLoopService,
        { provide: RAYCASTER, useValue: new Raycaster() },
        forwardRef(() => RaycasterService),
        { provide: ThView, useExisting: forwardRef(() => ThCanvas) }
    ], queries: [{ propertyName: "views", predicate: ThView }], viewQueries: [{ propertyName: "rendererCanvas", first: true, predicate: ["rendererCanvas"], descendants: true, static: true }], usesInheritance: true, ngImport: i0, template: '<canvas #rendererCanvas id="rendererCanvas"><ng-content *ngIf="isDevMode()" ></ng-content></canvas>', isInline: true, styles: [":host{display:flex;flex:auto;line-height:0;height:100%}canvas{flex:auto;outline:none;width:100%;height:100%}\n"], dependencies: [{ kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.1.1", ngImport: i0, type: ThCanvas, decorators: [{
            type: Component,
            args: [{ selector: 'th-canvas', template: '<canvas #rendererCanvas id="rendererCanvas"><ng-content *ngIf="isDevMode()" ></ng-content></canvas>', changeDetection: ChangeDetectionStrategy.OnPush, providers: [
                        { provide: ThObject3D, useExisting: forwardRef(() => ThCanvas) },
                        ThEngineService,
                        ThAnimationLoopService,
                        { provide: RAYCASTER, useValue: new Raycaster() },
                        forwardRef(() => RaycasterService),
                        { provide: ThView, useExisting: forwardRef(() => ThCanvas) }
                    ], styles: [":host{display:flex;flex:auto;line-height:0;height:100%}canvas{flex:auto;outline:none;width:100%;height:100%}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.ThEngineService }, { type: i2.ThAnimationLoopService }, { type: i4.RaycasterService, decorators: [{
                    type: Inject,
                    args: [forwardRef(() => RaycasterService)]
                }] }]; }, propDecorators: { rendererParameters: [{
                type: Input
            }], disableDefaultView: [{
                type: Input
            }], views: [{
                type: ContentChildren,
                args: [ThView]
            }], rendererCanvas: [{
                type: ViewChild,
                args: ['rendererCanvas', { static: true }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGhDYW52YXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtdGhyZWUvc3JjL2xpYi9UaENhbnZhcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBR0wsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFDVCxlQUFlLEVBRWYsVUFBVSxFQUNWLE1BQU0sRUFDTixLQUFLLEVBQ0wsU0FBUyxFQUdULFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsU0FBUyxFQUFpQixNQUFNLE9BQU8sQ0FBQztBQUNqRCxPQUFPLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDekUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3BELE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQzlFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sVUFBVSxDQUFDOzs7Ozs7QUFnQmxDLGtFQUFrRTtBQUNsRSxNQUFNLE9BQU8sUUFBUyxTQUFRLE1BQU07SUFxQmxDLElBQVcsR0FBRztRQUNaLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELElBQ1csS0FBSyxDQUFDLFFBQTJCO1FBQzFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUdELElBQ1csY0FBYyxDQUFDLE1BQWlEO1FBQ3pFLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDWCxPQUFPO1NBQ1I7UUFDRCxJQUFJLENBQUMsZUFBZSxHQUFHLE1BQU0sQ0FBQztRQUM5QixNQUFNLENBQUMsYUFBYSxDQUFDLEVBQUUsSUFBSSxJQUFJLENB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QVFLLEtBQUs7c0JBRGYsZUFBZTt1QkFBQyxNQUFNO2dCQU9aLGNBQWM7c0JBRHhCLFNBQVM7dUJBQUMsZ0JBQWdCLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJDb250ZW50Q2hlY2tlZCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBFbGVtZW50UmVmLFxuICBmb3J3YXJkUmVmLFxuICBJbmplY3QsXG4gIElucHV0LFxuICBpc0Rldk1vZGUsXG4gIE9uSW5pdCxcbiAgUXVlcnlMaXN0LFxuICBWaWV3Q2hpbGRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSYXljYXN0ZXIsIFdlYkdMUmVuZGVyZXIgfSBmcm9tICd0aHJlZSc7XG5pbXBvcnQgeyBSQVlDQVNURVIsIFJheWNhc3RlclNlcnZpY2UgfSBmcm9tICcuL2V2ZW50cy9yYXljYXN0ZXIuc2VydmljZSc7XG5pbXBvcnQgeyBUaE9iamVjdDNEIH0gZnJvbSAnLi9nZW5lcmF0ZWQvVGhPYmplY3QzRCc7XG5pbXBvcnQgeyBUaEFuaW1hdGlvbkxvb3BTZXJ2aWNlIH0gZnJvbSAnLi9yZW5kZXJlci90aC1hbmltYXRpb24tbG9vcC5zZXJ2aWNlJztcbmltcG9ydCB7IFRoRW5naW5lU2VydmljZSB9IGZyb20gJy4vVGhFbmdpbmUuc2VydmljZSc7XG5pbXBvcnQgeyBUaFZpZXcgfSBmcm9tICcuL1RoVmlldyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3RoLWNhbnZhcycsXG4gIHN0eWxlVXJsczogWycuL1RoQ2FudmFzLnNjc3MnXSxcbiAgdGVtcGxhdGU6ICc8Y2FudmFzICNyZW5kZXJlckNhbnZhcyBpZD1cInJlbmRlcmVyQ2FudmFzXCI+PG5nLWNvbnRlbnQgKm5nSWY9XCJpc0Rldk1vZGUoKVwiID48L25nLWNvbnRlbnQ+PC9jYW52YXM+JyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHByb3ZpZGVyczogW1xuICAgIHsgcHJvdmlkZTogVGhPYmplY3QzRCwgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gVGhDYW52YXMpIH0sXG4gICAgVGhFbmdpbmVTZXJ2aWNlLFxuICAgIFRoQW5pbWF0aW9uTG9vcFNlcnZpY2UsXG4gICAgeyBwcm92aWRlOiBSQVlDQVNURVIsIHVzZVZhbHVlOiBuZXcgUmF5Y2FzdGVyKCkgfSxcbiAgICBmb3J3YXJkUmVmKCgpID0+IFJheWNhc3RlclNlcnZpY2UpLFxuICAgIHsgcHJvdmlkZTogVGhWaWV3LCB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBUaENhbnZhcykgfVxuICBdXG59KVxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9jb21wb25lbnQtY2xhc3Mtc3VmZml4XG5leHBvcnQgY2xhc3MgVGhDYW52YXMgZXh0ZW5kcyBUaFZpZXcgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIEFmdGVyQ29udGVudENoZWNrZWQge1xuICBwdWJsaWMgcmVhZG9ubHkgaXNEZXZNb2RlID0gaXNEZXZNb2RlO1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZUNudCA9IDA7XG4gIHB1YmxpYyByZWFkb25seSBuaWQgPSBUaENhbnZhcy5pbnN0YW5jZUNudCsrO1xuXG4gIC8qKlxuICAgKiByZW5kZXJlciBwYXJhbWV0ZXJzXG4gICAqIHRob3NlIHdpbGwgYmUgYXBwbGllZCB0byB0aGUgcmVuZGVyZXIgZHVyaW5nIGNvbnN0cnVjdGlvbiAvIGluaXRpYWxpemF0aW9uXG4gICAqL1xuICBASW5wdXQoKVxuICByZW5kZXJlclBhcmFtZXRlcnM/OiBQYXJ0aWFsPFdlYkdMUmVuZGVyZXI+O1xuXG4gIC8qKlxuICAgKiBpZiB0cnVlIGRvZXMgbm90IHVzZSB0aGUgVGhDYW52YXMgYXMgdmlld1xuICAgKiB0aGlzIGlzIGVzZXBjaWFsbHkgdXNlZnVsbCBpZiB5b3UgaGF2ZSBtdWx0aXBsZSB2aWV3c1xuICAgKiBhbmQgd2FudCB0byBpdGVyYXRlIG92ZXIgYWxsIG9mIHRoZW0gd2l0aCAqbmdGb3JcbiAgICogdXNlIHN0YXRpY2FsbHkgKGJlZm9yZSBuZ09uSW5pdCBpcyB0cmlnZ2VyZWQpXG4gICAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgZGlzYWJsZURlZmF1bHRWaWV3ID0gZmFsc2U7XG5cbiAgcHVibGljIGdldCBvYmooKSB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBAQ29udGVudENoaWxkcmVuKFRoVmlldylcbiAgcHVibGljIHNldCB2aWV3cyh2aWV3TGlzdDogUXVlcnlMaXN0PFRoVmlldz4pIHtcbiAgICB2aWV3TGlzdC5mb3JFYWNoKCh2KSA9PiB0aGlzLmVuZ1NlcnYuYWRkVmlldyh2KSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgX3JlbmRlcmVyQ2FudmFzPzogRWxlbWVudFJlZjxIVE1MQ2FudmFzRWxlbWVudD47XG4gIEBWaWV3Q2hpbGQoJ3JlbmRlcmVyQ2FudmFzJywgeyBzdGF0aWM6IHRydWUgfSlcbiAgcHVibGljIHNldCByZW5kZXJlckNhbnZhcyhjYW52YXM6IEVsZW1lbnRSZWY8SFRNTENhbnZhc0VsZW1lbnQ+IHwgdW5kZWZpbmVkKSB7XG4gICAgaWYgKCFjYW52YXMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5fcmVuZGVyZXJDYW52YXMgPSBjYW52YXM7XG4gICAgY2FudmFzLm5hdGl2ZUVsZW1lbnQuaWQgKz0gdGhpcy5uaWQ7XG4gIH1cblxuICBwdWJsaWMgZ2V0IHJlbmRlcmVyQ2FudmFzKCkge1xuICAgIHJldHVybiB0aGlzLl9yZW5kZXJlckNhbnZhcztcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb3RlY3RlZCBlbmdTZXJ2OiBUaEVuZ2luZVNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIGFuaW1hdGlvbkxvb3A6IFRoQW5pbWF0aW9uTG9vcFNlcnZpY2UsXG4gICAgQEluamVjdChmb3J3YXJkUmVmKCgpID0+IFJheWNhc3RlclNlcnZpY2UpKVxuICAgIHByb3RlY3RlZCByYXljYXN0ZXI6IFJheWNhc3RlclNlcnZpY2VcbiAgKSB7XG4gICAgc3VwZXIoZW5nU2VydiwgcmF5Y2FzdGVyKTtcbiAgfVxuICBuZ0FmdGVyQ29udGVudENoZWNrZWQoKTogdm9pZCB7XG4gICAgdGhpcy5hbmltYXRpb25Mb29wLnJlcXVlc3RBbmltYXRpb25GcmFtZSgpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIHRoaXMuYW5pbWF0aW9uTG9vcC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKTtcbiAgfVxuXG4gIHB1YmxpYyBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmFwcGx5UmVuZGVyZXJQYXJhbWV0ZXJzKCk7XG5cbiAgICBzdXBlci5uZ09uSW5pdCgpO1xuICAgIGlmICghdGhpcy5kaXNhYmxlRGVmYXVsdFZpZXcpIHtcbiAgICAgIHRoaXMuZW5nU2Vydi5hZGRWaWV3KHRoaXMpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXBwbHlSZW5kZXJlclBhcmFtZXRlcnMoKSB7XG4gICAgaWYgKCF0aGlzLnJlbmRlcmVyQ2FudmFzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgQ2FudmFzJyk7XG4gICAgfVxuXG4gICAgdGhpcy5lbmdTZXJ2LnNldFJlbmRlcmVyKHsgLi4udGhpcy5yZW5kZXJlclBhcmFtZXRlcnMsIGRvbUVsZW1lbnQ6IHRoaXMucmVuZGVyZXJDYW52YXMubmF0aXZlRWxlbWVudCB9KTtcbiAgfVxufVxuIl19