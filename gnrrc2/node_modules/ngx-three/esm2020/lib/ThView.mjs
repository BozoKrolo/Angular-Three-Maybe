import { Component, ContentChild, EventEmitter, forwardRef, Input, Output } from '@angular/core';
import { Raycaster, Vector4 } from 'three';
import { RAYCASTER, RaycasterService } from './events/raycaster.service';
import { ThCamera } from './generated/ThCamera';
import { ThObject3D } from './generated/ThObject3D';
import { ThScene } from './generated/ThScene';
import * as i0 from "@angular/core";
import * as i1 from "./ThEngine.service";
import * as i2 from "./events/raycaster.service";
// eslint-disable-next-line @angular-eslint/component-class-suffix
export class ThView {
    constructor(engServ, raycaster) {
        this.engServ = engServ;
        this.raycaster = raycaster;
        // -----------------------------------------------------------------------------------------------
        // eslint-disable-next-line @angular-eslint/no-output-on-prefix
        this.onRender = new EventEmitter();
    }
    set contentScene(scene) {
        if (scene) {
            this.scene = scene;
        }
    }
    set effectComposer(effectComposer) {
        this._effectComposer = effectComposer;
        this.configureEffectComposerRenderTarget();
    }
    get effectComposer() {
        return this._effectComposer;
    }
    set camera(camera) {
        this._camera = camera;
        this.initRaycaster();
    }
    get camera() {
        return this._camera;
    }
    set contentCamera(camera) {
        if (camera) {
            this.camera = camera;
        }
    }
    set viewPort(viewPort) {
        this._viewPort = viewPort;
        this.configureEffectComposerRenderTarget();
    }
    get viewPort() {
        return this._viewPort;
    }
    ngOnInit() {
        this.initRaycaster();
    }
    initRaycaster() {
        if (this.camera && this.engServ.canvas) {
            this.raycaster.init(this.camera, this.engServ.canvas);
        }
    }
    add(scene) {
        // nothing to do here
    }
    remove(scene) {
        // norhing to do
    }
    configureEffectComposerRenderTarget() {
        if (!this.viewPort || !this.effectComposer) {
            return;
        }
        else {
            let width;
            let height;
            if (this.viewPort instanceof Vector4) {
                width = this.viewPort.z;
                height = this.viewPort?.width;
            }
            else {
                width = this.viewPort.width;
                height = this.viewPort.height;
            }
            //TODO: check if pixel ration ha
            this.effectComposer.setSize(width, height);
        }
    }
}
ThView.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.1.1", ngImport: i0, type: ThView, deps: [{ token: i1.ThEngineService }, { token: i2.RaycasterService }], target: i0.ɵɵFactoryTarget.Component });
ThView.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.1.1", type: ThView, selector: "th-view", inputs: { scene: "scene", effectComposer: "effectComposer", camera: "camera", shadow: "shadow", viewPort: "viewPort", scissor: "scissor", scissorTest: "scissorTest", clearColor: "clearColor", clearAlpha: "clearAlpha" }, outputs: { onRender: "onRender" }, providers: [
        { provide: ThObject3D, useExisting: forwardRef(() => ThView) },
        { provide: RAYCASTER, useValue: new Raycaster() },
        RaycasterService
    ], queries: [{ propertyName: "contentScene", first: true, predicate: ThScene, descendants: true }, { propertyName: "contentCamera", first: true, predicate: ThCamera, descendants: true }], ngImport: i0, template: '<ng-content/>', isInline: true });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.1.1", ngImport: i0, type: ThView, decorators: [{
            type: Component,
            args: [{
                    selector: 'th-view',
                    template: '<ng-content/>',
                    providers: [
                        { provide: ThObject3D, useExisting: forwardRef(() => ThView) },
                        { provide: RAYCASTER, useValue: new Raycaster() },
                        RaycasterService
                    ]
                }]
        }], ctorParameters: function () { return [{ type: i1.ThEngineService }, { type: i2.RaycasterService }]; }, propDecorators: { scene: [{
                type: Input
            }], contentScene: [{
                type: ContentChild,
                args: [ThScene]
            }], effectComposer: [{
                type: Input
            }], camera: [{
                type: Input
            }], contentCamera: [{
                type: ContentChild,
                args: [ThCamera]
            }], shadow: [{
                type: Input
            }], viewPort: [{
                type: Input
            }], scissor: [{
                type: Input
            }], scissorTest: [{
                type: Input
            }], clearColor: [{
                type: Input
            }], clearAlpha: [{
                type: Input
            }], onRender: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGhWaWV3LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LXRocmVlL3NyYy9saWIvVGhWaWV3LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6RyxPQUFPLEVBQW1CLFNBQVMsRUFBRSxPQUFPLEVBQUUsTUFBTSxPQUFPLENBQUM7QUFFNUQsT0FBTyxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNoRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDcEQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHFCQUFxQixDQUFDOzs7O0FBWTlDLGtFQUFrRTtBQUNsRSxNQUFNLE9BQU8sTUFBTTtJQU9qQixZQUFzQixPQUF3QixFQUFZLFNBQTJCO1FBQS9ELFlBQU8sR0FBUCxPQUFPLENBQWlCO1FBQVksY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUE4RXJGLGtHQUFrRztRQUVsRywrREFBK0Q7UUFFL0MsYUFBUSxHQUFHLElBQUksWUFBWSxFQUl2QyxDQUFDO0lBdEZtRixDQUFDO0lBS3pGLElBQ1csWUFBWSxDQUFDLEtBQTBCO1FBQ2hELElBQUksS0FBSyxFQUFFO1lBQ1QsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7U0FDcEI7SUFDSCxDQUFDO0lBRUQsSUFDVyxjQUFjLENBQUMsY0FBMEM7UUFDbEUsSUFBSSxDQUFDLGVBQWUsR0FBRyxjQUFjLENBQUM7UUFDdEMsSUFBSSxDQUFDLG1DQUFtQyxFQUFFLENBQUM7SUFDN0MsQ0FBQztJQUVELElBQVcsY0FBYztRQUN2QixPQUFPLElBQUksQ0FBQyxlQUFl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QixLQUFLO2dCQVdLLGFBQWE7c0JBRHZCLFlBQVk7dUJBQUMsUUFBUTtnQkFhZixNQUFNO3NCQURaLEtBQUs7Z0JBSUssUUFBUTtzQkFEbEIsS0FBSztnQkFXQyxPQUFPO3NCQURiLEtBQUs7Z0JBUUMsV0FBVztzQkFEakIsS0FBSztnQkFPTixVQUFVO3NCQURULEtBQUs7Z0JBT04sVUFBVTtzQkFEVCxLQUFLO2dCQU1VLFFBQVE7c0JBRHZCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIENvbnRlbnRDaGlsZCwgRXZlbnRFbWl0dGVyLCBmb3J3YXJkUmVmLCBJbnB1dCwgT25Jbml0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbG9yLCBPYmplY3QzRCwgUmF5Y2FzdGVyLCBWZWN0b3I0IH0gZnJvbSAndGhyZWUnO1xuaW1wb3J0IHsgRWZmZWN0Q29tcG9zZXIgfSBmcm9tICd0aHJlZS9leGFtcGxlcy9qc20vcG9zdHByb2Nlc3NpbmcvRWZmZWN0Q29tcG9zZXInO1xuaW1wb3J0IHsgUkFZQ0FTVEVSLCBSYXljYXN0ZXJTZXJ2aWNlIH0gZnJvbSAnLi9ldmVudHMvcmF5Y2FzdGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgVGhDYW1lcmEgfSBmcm9tICcuL2dlbmVyYXRlZC9UaENhbWVyYSc7XG5pbXBvcnQgeyBUaE9iamVjdDNEIH0gZnJvbSAnLi9nZW5lcmF0ZWQvVGhPYmplY3QzRCc7XG5pbXBvcnQgeyBUaFNjZW5lIH0gZnJvbSAnLi9nZW5lcmF0ZWQvVGhTY2VuZSc7XG5pbXBvcnQgeyBUaEVuZ2luZVNlcnZpY2UgfSBmcm9tICcuL1RoRW5naW5lLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd0aC12aWV3JyxcbiAgdGVtcGxhdGU6ICc8bmctY29udGVudC8+JyxcbiAgcHJvdmlkZXJzOiBbXG4gICAgeyBwcm92aWRlOiBUaE9iamVjdDNELCB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBUaFZpZXcpIH0sXG4gICAgeyBwcm92aWRlOiBSQVlDQVNURVIsIHVzZVZhbHVlOiBuZXcgUmF5Y2FzdGVyKCkgfSxcbiAgICBSYXljYXN0ZXJTZXJ2aWNlXG4gIF1cbn0pXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L2NvbXBvbmVudC1jbGFzcy1zdWZmaXhcbmV4cG9ydCBjbGFzcyBUaFZpZXcgaW1wbGVtZW50cyBPbkluaXQge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25hbWluZy1jb252ZW50aW9uLCBuby11bmRlcnNjb3JlLWRhbmdsZSwgaWQtYmxhY2tsaXN0LCBpZC1tYXRjaFxuICBwcm90ZWN0ZWQgX2NhbWVyYT86IFRoQ2FtZXJhO1xuICBwcm90ZWN0ZWQgX3ZpZXdQb3J0PzogVmVjdG9yNCB8IHsgeDogbnVtYmVyOyB5OiBudW1iZXI7IHdpZHRoOiBudW1iZXI7IGhlaWdodDogbnVtYmVyIH07XG5cbiAgcHJvdGVjdGVkIF9lZmZlY3RDb21wb3Nlcj86IEVmZmVjdENvbXBvc2VyO1xuXG4gIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBlbmdTZXJ2OiBUaEVuZ2luZVNlcnZpY2UsIHByb3RlY3RlZCByYXljYXN0ZXI6IFJheWNhc3RlclNlcnZpY2UpIHt9XG5cbiAgQElucHV0KClcbiAgcHVibGljIHNjZW5lPzogVGhTY2VuZTtcblxuICBAQ29udGVudENoaWxkKFRoU2NlbmUpXG4gIHB1YmxpYyBzZXQgY29udGVudFNjZW5lKHNjZW5lOiBUaFNjZW5lIHwgdW5kZWZpbmVkKSB7XG4gICAgaWYgKHNjZW5lKSB7XG4gICAgICB0aGlzLnNjZW5lID0gc2NlbmU7XG4gICAgfVxuICB9XG5cbiAgQElucHV0KClcbiAgcHVibGljIHNldCBlZmZlY3RDb21wb3NlcihlZmZlY3RDb21wb3NlcjogRWZmZWN0Q29tcG9zZXIgfCB1bmRlZmluZWQpIHtcbiAgICB0aGlzLl9lZmZlY3RDb21wb3NlciA9IGVmZmVjdENvbXBvc2VyO1xuICAgIHRoaXMuY29uZmlndXJlRWZmZWN0Q29tcG9zZXJSZW5kZXJUYXJnZXQoKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgZWZmZWN0Q29tcG9zZXIoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2VmZmVjdENvbXBvc2VyO1xuICB9XG5cbiAgQElucHV0KClcbiAgcHVibGljIHNldCBjYW1lcmEoY2FtZXJhOiBUaENhbWVyYSB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMuX2NhbWVyYSA9IGNhbWVyYTtcbiAgICB0aGlzLmluaXRSYXljYXN0ZXIoKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgY2FtZXJhKCkge1xuICAgIHJldHVybiB0aGlzLl9jYW1lcmE7XG4gIH1cblxuICBAQ29udGVudENoaWxkKFRoQ2FtZXJhKVxuICBwdWJsaWMgc2V0IGNvbnRlbnRDYW1lcmEoY2FtZXJhOiBUaENhbWVyYTxhbnk+IHwgdW5kZWZpbmVkKSB7XG4gICAgaWYgKGNhbWVyYSkge1xuICAgICAgdGhpcy5jYW1lcmEgPSBjYW1lcmE7XG4gICAgfVxuICB9XG5cbiAgLy8gcmVuZGVyZXIgcGFyYW1ldGVyc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogZW5hYmxlIC8gZGlzYWJsZSBzaGFkb3dzXG4gICAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgc2hhZG93PzogYm9vbGVhbjtcblxuICBASW5wdXQoKVxuICBwdWJsaWMgc2V0IHZpZXdQb3J0KHZpZXdQb3J0OiBWZWN0b3I0IHwgeyB4OiBudW1iZXI7IHk6IG51bWJlcjsgd2lkdGg6IG51bWJlcjsgaGVpZ2h0OiBudW1iZXIgfSB8IHVuZGVmaW5lZCkge1xuICAgIHRoaXMuX3ZpZXdQb3J0ID0gdmlld1BvcnQ7XG4gICAgdGhpcy5jb25maWd1cmVFZmZlY3RDb21wb3NlclJlbmRlclRhcmdldCgpO1xuICB9XG5cbiAgcHVibGljIGdldCB2aWV3UG9ydCgpIHtcbiAgICByZXR1cm4gdGhpcy5fdmlld1BvcnQ7XG4gIH1cblxuICBASW5wdXQoKVxuICBwdWJsaWMgc2Npc3Nvcj86IFZlY3RvcjQgfCB7IHg6IG51bWJlcjsgeTogbnVtYmVyOyB3aWR0aDogbnVtYmVyOyBoZWlnaHQ6IG51bWJlciB9O1xuXG4gIC8qKlxuICAgKiBFbmFibGUgdGhlIHNjaXNzb3IgdGVzdC4gV2hlbiB0aGlzIGlzIGVuYWJsZWQsXG4gICAqIG9ubHkgdGhlIHBpeGVscyB3aXRoaW4gdGhlIGRlZmluZWQgc2Npc3NvciBhcmVhIHdpbGwgYmUgYWZmZWN0ZWQgYnkgZnVydGhlciByZW5kZXJlciBhY3Rpb25zLlxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIHNjaXNzb3JUZXN0PzogYm9vbGVhbjtcblxuICAvKipcbiAgICogU2V0cyB0aGUgY2xlYXIgY29sb3JcbiAgICovXG4gIEBJbnB1dCgpXG4gIGNsZWFyQ29sb3I/OiBDb2xvciB8IHN0cmluZyB8IG51bWJlcjtcblxuICAvKipcbiAgICogYSBmbG9hdCB3aXRoIHRoZSBjdXJyZW50IGNsZWFyIGFscGhhLiBSYW5nZXMgZnJvbSAwIHRvIDEuXG4gICAqL1xuICBASW5wdXQoKVxuICBjbGVhckFscGhhPzogbnVtYmVyO1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LW9uLXByZWZpeFxuICBAT3V0cHV0KClcbiAgcHVibGljIHJlYWRvbmx5IG9uUmVuZGVyID0gbmV3IEV2ZW50RW1pdHRlcjx7XG4gICAgcmVuZGVyZXI6IFRIUkVFLldlYkdMUmVuZGVyZXI7XG4gICAgc2NlbmU6IFRoU2NlbmU7XG4gICAgY2FtZXJhOiBUaENhbWVyYTtcbiAgfT4oKTtcblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmluaXRSYXljYXN0ZXIoKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdFJheWNhc3RlcigpIHtcbiAgICBpZiAodGhpcy5jYW1lcmEgJiYgdGhpcy5lbmdTZXJ2LmNhbnZhcykge1xuICAgICAgdGhpcy5yYXljYXN0ZXIuaW5pdCh0aGlzLmNhbWVyYSwgdGhpcy5lbmdTZXJ2LmNhbnZhcyk7XG4gICAgfVxuICB9XG5cbiAgYWRkKHNjZW5lOiBPYmplY3QzRCkge1xuICAgIC8vIG5vdGhpbmcgdG8gZG8gaGVyZVxuICB9XG5cbiAgcmVtb3ZlKHNjZW5lOiBPYmplY3QzRCkge1xuICAgIC8vIG5vcmhpbmcgdG8gZG9cbiAgfVxuXG4gIHByaXZhdGUgY29uZmlndXJlRWZmZWN0Q29tcG9zZXJSZW5kZXJUYXJnZXQoKSB7XG4gICAgaWYgKCF0aGlzLnZpZXdQb3J0IHx8ICF0aGlzLmVmZmVjdENvbXBvc2VyKSB7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCB3aWR0aDogbnVtYmVyO1xuICAgICAgbGV0IGhlaWdodDogbnVtYmVyO1xuICAgICAgaWYgKHRoaXMudmlld1BvcnQgaW5zdGFuY2VvZiBWZWN0b3I0KSB7XG4gICAgICAgIHdpZHRoID0gdGhpcy52aWV3UG9ydC56O1xuICAgICAgICBoZWlnaHQgPSB0aGlzLnZpZXdQb3J0Py53aWR0aDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdpZHRoID0gdGhpcy52aWV3UG9ydC53aWR0aDtcbiAgICAgICAgaGVpZ2h0ID0gdGhpcy52aWV3UG9ydC5oZWlnaHQ7XG4gICAgICB9XG4gICAgICAvL1RPRE86IGNoZWNrIGlmIHBpeGVsIHJhdGlvbiBoYVxuICAgICAgdGhpcy5lZmZlY3RDb21wb3Nlci5zZXRTaXplKHdpZHRoLCBoZWlnaHQpO1xuICAgIH1cbiAgfVxufVxuIl19