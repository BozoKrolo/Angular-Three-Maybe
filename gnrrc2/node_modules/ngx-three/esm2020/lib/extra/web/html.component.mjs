/**
 * The following code is ported from pmndrs/drei and adapted to work with Angular and ngx-three
 * Many thanks to pmndrs/drei at its contributors!
 */
import { ChangeDetectionStrategy, Component, EventEmitter, inject, Input, Output, SkipSelf, ViewChild } from '@angular/core';
import { OrthographicCamera, PerspectiveCamera, Vector3 } from 'three';
import { RAYCASTER } from '../../events/raycaster.service';
import { ThGroup } from '../../generated';
import * as i0 from "@angular/core";
import * as i1 from "../../ThView";
import * as i2 from "../../ThCanvas";
import * as i3 from "../../generated";
import * as i4 from "@angular/common";
import * as i5 from "../../renderer/th-render.directive";
const v1 = new Vector3();
const v2 = new Vector3();
const v3 = new Vector3();
function defaultCalculatePosition(el, camera, size) {
    const objectPos = v1.setFromMatrixPosition(el.matrixWorld);
    objectPos.project(camera);
    const widthHalf = size.width / 2;
    const heightHalf = size.height / 2;
    return [objectPos.x * widthHalf + widthHalf, -(objectPos.y * heightHalf) + heightHalf];
}
function isObjectBehindCamera(el, camera) {
    const objectPos = v1.setFromMatrixPosition(el.matrixWorld);
    const cameraPos = v2.setFromMatrixPosition(camera.matrixWorld);
    const deltaCamObj = objectPos.sub(cameraPos);
    const camDir = camera.getWorldDirection(v3);
    return deltaCamObj.angleTo(camDir) > Math.PI / 2;
}
function isObjectVisible(el, camera, raycaster, occlude) {
    const elPos = v1.setFromMatrixPosition(el.matrixWorld);
    const screenPos = elPos.clone();
    screenPos.project(camera);
    raycaster.setFromCamera(screenPos, camera);
    const intersects = raycaster.intersectObjects(occlude, true);
    if (intersects.length) {
        const intersectionDistance = intersects[0].distance;
        const pointDistance = elPos.distanceTo(raycaster.ray.origin);
        return pointDistance < intersectionDistance;
    }
    return true;
}
function objectScale(el, camera) {
    if (camera instanceof OrthographicCamera) {
        return camera.zoom;
    }
    else if (camera instanceof PerspectiveCamera) {
        const objectPos = v1.setFromMatrixPosition(el.matrixWorld);
        const cameraPos = v2.setFromMatrixPosition(camera.matrixWorld);
        const vFOV = (camera.fov * Math.PI) / 180;
        const dist = objectPos.distanceTo(cameraPos);
        const scaleFOV = 2 * Math.tan(vFOV / 2) * dist;
        return 1 / scaleFOV;
    }
    else {
        return 1;
    }
}
function objectZIndex(el, camera, zIndexRange) {
    if (camera instanceof PerspectiveCamera || camera instanceof OrthographicCamera) {
        const objectPos = v1.setFromMatrixPosition(el.matrixWorld);
        const cameraPos = v2.setFromMatrixPosition(camera.matrixWorld);
        const dist = objectPos.distanceTo(cameraPos);
        const A = (zIndexRange[1] - zIndexRange[0]) / (camera.far - camera.near);
        const B = zIndexRange[1] - A * camera.far;
        return Math.round(A * dist + B);
    }
    return undefined;
}
const epsilon = (value) => (Math.abs(value) < 1e-10 ? 0 : value);
function getCSSMatrix(matrix, multipliers, prepend = '') {
    let matrix3d = 'matrix3d(';
    for (let i = 0; i !== 16; i++) {
        matrix3d += epsilon(multipliers[i] * matrix.elements[i]) + (i !== 15 ? ',' : ')');
    }
    return prepend + matrix3d;
}
const getCameraCSSMatrix = ((multipliers) => (matrix) => getCSSMatrix(matrix, multipliers))([1, -1, 1, 1, 1, -1, 1, 1, 1, -1, 1, 1, 1, -1, 1, 1]);
const getObjectCSSMatrix = ((scaleMultipliers) => (matrix, factor) => getCSSMatrix(matrix, scaleMultipliers(factor), 'translate(-50%,-50%)'))((f) => [1 / f, 1 / f, 1 / f, 1, -1 / f, -1 / f, -1 / f, -1, 1 / f, 1 / f, 1 / f, 1, 1, 1, 1, 1]);
/**
 * A port of the pmndrs/drei Html component
 *
 * Add Html content to any three.js object3d node
 */
export class HtmlComponent extends ThGroup {
    constructor(view, canvas, parent) {
        super(parent);
        this.view = view;
        this.canvas = canvas;
        this.prepend = false; // Project content behind the canvas (default: false)
        this.center = false; // Adds a -50%/-50% css transform (default: false) [ignored in transform mode]
        this.fullscreen = false; // Aligns to the upper-left corner, fills the screen (default:false) [ignored in transform mode]
        this.eps = 0.001;
        this.sprite = false; // Renders as sprite, but only in transform mode (default=false)
        this.transform = false; // If true, applies matrix3d transformations (default=false)
        this.zIndexRange = [16777271, 0]; // Z-order range (default=[16777271, 0])
        this.onOcclude = new EventEmitter();
        /**
         * Override default positioning function. [ignored in transform mode]
         */
        this.calculatePosition = defaultCalculatePosition;
        this.as = 'div'; // Wrapping element (default: 'div')
        this.pointerEvents = 'auto';
        this.transformInnerStyles = this.computeInnerStyles();
        this.styles = null;
        this.oldZoom = 0;
        this.oldPosition = [0, 0];
        this.notOccluded = true;
        this.raycaster = inject(RAYCASTER);
    }
    ngOnInit() {
        super.ngOnInit();
        this.styles = this.computeStyles();
    }
    ngAfterViewInit() {
        this.el = document.createElement(this.as);
        this.frameSubscription = this.view.onRender.subscribe(() => this.onFrame());
        if (this.transformOuterRef) {
            this.el.appendChild(this.transformOuterRef.nativeElement);
        }
        if (this.el && !this.target) {
            this.appendElement(this.el);
        }
    }
    onResize() {
        this.styles = this.computeStyles();
    }
    ngOnChanges(changes) {
        super.ngOnChanges(changes);
        /*
        if(this.el) {
          if(changes.portal || changes.transform) {
            this.appendElement(this.el);
          }
    
          if(changes.wrapperClass) {
            this.el.className = changes.wrapperClass.currentValue ?? '';
          }
    
          if(changes.pointerEvents) {
            this.transformInnerStyles = this.computeInnerStyles();
          }
        }
        */
    }
    appendElement(el) {
        if (!this.el || !this.objRef || !this.canvas.rendererCanvas || !this.view.camera) {
            return;
        }
        this.target = this.portal ?? this.canvas.rendererCanvas?.nativeElement.parentElement;
        this.view.scene?.objRef?.updateMatrixWorld();
        if (this.transform) {
            el.style.cssText = 'position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;';
        }
        else {
            const vec = this.calculatePosition(this.objRef, this.view.camera.objRef, this.getSize());
            el.style.cssText = `position:absolute;top:0;left:0;transform:translate3d(${vec[0]}px,${vec[1]}px,0);transform-origin:0 0;`;
        }
        if (this.target) {
            if (this.prepend) {
                this.target.prepend(el);
            }
            else {
                this.target.appendChild(el);
            }
        }
    }
    onFrame() {
        const camera = this.view.camera?.objRef;
        const scene = this.view.scene?.objRef;
        const group = this._objRef;
        const size = this.getSize();
        if (!camera || !group || !scene || !this.el) {
            return;
        }
        camera.updateMatrixWorld();
        group.updateWorldMatrix(true, false);
        const vec = this.transform ? this.oldPosition : this.calculatePosition(group, camera, size);
        if (this.transform ||
            Math.abs(this.oldZoom - camera.zoom) > this.eps ||
            Math.abs(this.oldPosition[0] - vec[0]) > this.eps ||
            Math.abs(this.oldPosition[1] - vec[1]) > this.eps) {
            const isBehindCamera = isObjectBehindCamera(group, camera);
            let raytraceTarget = false;
            if (typeof this.occlude === 'boolean') {
                if (this.occlude === true) {
                    raytraceTarget = [scene];
                }
            }
            else if (Array.isArray(this.occlude)) {
                raytraceTarget = this.occlude.map((item) => item.objRef ?? item);
            }
            const previouslyVisible = this.notOccluded;
            if (raytraceTarget) {
                this.notOccluded = !isBehindCamera && isObjectVisible(group, camera, this.raycaster, raytraceTarget);
            }
            else {
                this.notOccluded = !isBehindCamera;
            }
            if (previouslyVisible !== this.notOccluded) {
                if (this.onOcclude.length > 0) {
                    this.onOcclude.next(!this.notOccluded);
                }
                else {
                    this.el.style.display = this.notOccluded ? 'block' : 'none';
                }
            }
            this.el.style.zIndex = `${objectZIndex(group, camera, this.zIndexRange)}`;
            if (this.transform) {
                const [widthHalf, heightHalf] = [size.width / 2, size.height / 2];
                const fov = camera.projectionMatrix.elements[5] * heightHalf;
                const { isOrthographicCamera, top, left, bottom, right } = camera;
                const cameraMatrix = getCameraCSSMatrix(camera.matrixWorldInverse);
                const cameraTransform = isOrthographicCamera
                    ? `scale(${fov})translate(${epsilon(-(right + left) / 2)}px,${epsilon((top + bottom) / 2)}px)`
                    : `translateZ(${fov}px)`;
                let matrix = group.matrixWorld;
                if (this.sprite) {
                    matrix = camera.matrixWorldInverse.clone().transpose().copyPosition(matrix).scale(group.scale);
                    matrix.elements[3] = matrix.elements[7] = matrix.elements[11] = 0;
                    matrix.elements[15] = 1;
                }
                this.el.style.width = size.width + 'px';
                this.el.style.height = size.height + 'px';
                this.el.style.perspective = isOrthographicCamera ? '' : `${fov}px`;
                if (this.transformOuterRef && this.transformInnerRef) {
                    // eslint-disable-next-line max-len
                    this.transformOuterRef.nativeElement.style.transform = `${cameraTransform}${cameraMatrix}translate(${widthHalf}px,${heightHalf}px)`;
                    this.transformInnerRef.nativeElement.style.transform = getObjectCSSMatrix(matrix, 1 / ((this.distanceFactor || 10) / 400));
                }
            }
            else {
                const scale = this.distanceFactor === undefined ? 1 : objectScale(group, camera) * this.distanceFactor;
                this.el.style.transform = `translate3d(${vec[0]}px,${vec[1]}px,0) scale(${scale})`;
            }
            this.oldPosition = vec;
            this.oldZoom = camera.zoom;
        }
    }
    ngOnDestroy() {
        this.el?.remove();
        this.frameSubscription?.unsubscribe();
    }
    computeStyles() {
        const size = this.getSize();
        if (this.transform) {
            return {
                position: 'absolute',
                top: 0,
                left: 0,
                width: size.width + 'px',
                height: size.height + 'px',
                transformStyle: 'preserve-3d',
                pointerEvents: 'none'
            };
        }
        else {
            return {
                position: 'absolute',
                transform: this.center ? 'translate3d(-50%,-50%,0)' : 'none',
                ...(this.fullscreen && {
                    top: -size.height / 2 + 'px',
                    left: -size.width / 2 + 'px',
                    width: size.width + 'px',
                    height: size.height + 'px'
                }),
                ...this.style
            };
        }
    }
    computeInnerStyles() {
        return { position: 'absolute', pointerEvents: this.pointerEvents };
    }
    getSize() {
        return (this.view.viewPort ?? this.canvas.rendererCanvas?.nativeElement.getBoundingClientRect() ?? { width: 0, height: 0 });
    }
}
HtmlComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.1.1", ngImport: i0, type: HtmlComponent, deps: [{ token: i1.ThView }, { token: i2.ThCanvas }, { token: i3.ThObject3D, skipSelf: true }], target: i0.ɵɵFactoryTarget.Component });
HtmlComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.1.1", type: HtmlComponent, selector: "th-html", inputs: { prepend: "prepend", center: "center", fullscreen: "fullscreen", portal: "portal", distanceFactor: "distanceFactor", sprite: "sprite", transform: "transform", zIndexRange: "zIndexRange", style: "style", className: "className", occlude: "occlude", calculatePosition: "calculatePosition", as: "as", wrapperClass: "wrapperClass", pointerEvents: "pointerEvents" }, outputs: { onOcclude: "onOcclude" }, viewQueries: [{ propertyName: "transformOuterRef", first: true, predicate: ["outerRef"], descendants: true }, { propertyName: "transformInnerRef", first: true, predicate: ["innerRef"], descendants: true }], usesInheritance: true, usesOnChanges: true, ngImport: i0, template: "<div [ngStyle]=\"styles\" #outerRef *ngIf=\"transform;  else noTransform\" (onResize)=\"onResize()\">\n    <div #innerRef [ngStyle]=\"transformInnerStyles\" >\n        <div [style]=\"style\" [className]=\"className\">\n            <ng-container *ngTemplateOutlet=\"tempOutlet\" ></ng-container>\n        </div>\n    </div>\n</div>\n<ng-template #noTransform>\n    <div [ngStyle]=\"styles\" [className]=\"className\" #outerRef>\n        <ng-container *ngTemplateOutlet=\"tempOutlet\" ></ng-container>\n    </div>\n</ng-template>\n\n<ng-template #tempOutlet>\n    <ng-content></ng-content>\n</ng-template>\n", dependencies: [{ kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i4.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "directive", type: i4.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { kind: "directive", type: i5.ThRenderDirective, selector: "[beforeRender], [onResize], [renderOnDemand]", inputs: ["renderOnDemand"], outputs: ["beforeRender", "onResize"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.1.1", ngImport: i0, type: HtmlComponent, decorators: [{
            type: Component,
            args: [{ selector: 'th-html', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div [ngStyle]=\"styles\" #outerRef *ngIf=\"transform;  else noTransform\" (onResize)=\"onResize()\">\n    <div #innerRef [ngStyle]=\"transformInnerStyles\" >\n        <div [style]=\"style\" [className]=\"className\">\n            <ng-container *ngTemplateOutlet=\"tempOutlet\" ></ng-container>\n        </div>\n    </div>\n</div>\n<ng-template #noTransform>\n    <div [ngStyle]=\"styles\" [className]=\"className\" #outerRef>\n        <ng-container *ngTemplateOutlet=\"tempOutlet\" ></ng-container>\n    </div>\n</ng-template>\n\n<ng-template #tempOutlet>\n    <ng-content></ng-content>\n</ng-template>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ThView }, { type: i2.ThCanvas }, { type: i3.ThObject3D, decorators: [{
                    type: SkipSelf
                }] }]; }, propDecorators: { prepend: [{
                type: Input
            }], center: [{
                type: Input
            }], fullscreen: [{
                type: Input
            }], portal: [{
                type: Input
            }], distanceFactor: [{
                type: Input
            }], sprite: [{
                type: Input
            }], transform: [{
                type: Input
            }], zIndexRange: [{
                type: Input
            }], style: [{
                type: Input
            }], className: [{
                type: Input
            }], occlude: [{
                type: Input
            }], onOcclude: [{
                type: Output
            }], calculatePosition: [{
                type: Input
            }], as: [{
                type: Input
            }], wrapperClass: [{
                type: Input
            }], pointerEvents: [{
                type: Input
            }], transformOuterRef: [{
                type: ViewChild,
                args: ['outerRef']
            }], transformInnerRef: [{
                type: ViewChild,
                args: ['innerRef']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHRtbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtdGhyZWUvc3JjL2xpYi9leHRyYS93ZWIvaHRtbC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtdGhyZWUvc3JjL2xpYi9leHRyYS93ZWIvaHRtbC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0dBR0c7QUFFSCxPQUFPLEVBRUwsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFFVCxZQUFZLEVBQ1osTUFBTSxFQUNOLEtBQUssRUFJTCxNQUFNLEVBQ04sUUFBUSxFQUNSLFNBQVMsRUFDVixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBS0wsa0JBQWtCLEVBQ2xCLGlCQUFpQixFQUdqQixPQUFPLEVBQ1IsTUFBTSxPQUFPLENBQUM7QUFDZixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDM0QsT0FBTyxFQUFFLE9BQU8sRUFBYyxNQUFNLGlCQUFpQixDQUFDOzs7Ozs7O0FBS3RELE1BQU0sRUFBRSxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7QUFDekIsTUFBTSxFQUFFLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztBQUN6QixNQUFNLEVBQUUsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO0FBRXpCLFNBQVMsd0JBQXdCLENBQUMsRUFBWSxFQUFFLE1BQWMsRUFBRSxJQUF1QztJQUNyRyxNQUFNLFNBQVMsR0FBRyxFQUFFLENBQUMscUJBQXFCLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQzNELFNBQVMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDMUIsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7SUFDakMsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxD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RSxDQUNuSCxDQUFDO0lBQ0osQ0FBQzs7MEdBdk9VLGFBQWE7OEZBQWIsYUFBYSxpc0JDaEoxQiwrbEJBZ0JBOzJGRGdJYSxhQUFhO2tCQUx6QixTQUFTOytCQUNFLFNBQVMsbUJBRUYsdUJBQXVCLENBQUMsTUFBTTs7MEJBa0RjLFFBQVE7NENBL0M1RCxPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csTUFBTTtzQkFBZCxLQUFLO2dCQUNHLFVBQVU7c0JBQWxCLEtBQUs7Z0JBRUcsTUFBTTtzQkFBZCxLQUFLO2dCQUlHLGNBQWM7c0JBQXRCLEtBQUs7Z0JBQ0csTUFBTTtzQkFBZCxLQUFLO2dCQUNHLFNBQVM7c0JBQWpCLEtBQUs7Z0JBQ0csV0FBVztzQkFBbkIsS0FBSztnQkFFRyxLQUFLO3NCQUFiLEtBQUs7Z0JBQ0csU0FBUztzQkFBakIsS0FBSztnQkFLRyxPQUFPO3NCQUFmLEtBQUs7Z0JBRUMsU0FBUztzQkFEZixNQUFNO2dCQU1FLGlCQUFpQjtzQkFBekIsS0FBSztnQkFDRyxFQUFFO3NCQUFWLEtBQUs7Z0JBQ0csWUFBWTtzQkFBcEIsS0FBSztnQkFDRyxhQUFhO3NCQUFyQixLQUFLO2dCQVVFLGlCQUFpQjtzQkFEeEIsU0FBUzt1QkFBQyxVQUFVO2dCQUdiLGlCQUFpQjtzQkFEeEIsU0FBUzt1QkFBQyxVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUaGUgZm9sbG93aW5nIGNvZGUgaXMgcG9ydGVkIGZyb20gcG1uZHJzL2RyZWkgYW5kIGFkYXB0ZWQgdG8gd29yayB3aXRoIEFuZ3VsYXIgYW5kIG5neC10aHJlZVxuICogTWFueSB0aGFua3MgdG8gcG1uZHJzL2RyZWkgYXQgaXRzIGNvbnRyaWJ1dG9ycyFcbiAqL1xuXG5pbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIGluamVjdCxcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgU2tpcFNlbGYsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcbiAgQ2FtZXJhLFxuICBHcm91cCxcbiAgTWF0cml4NCxcbiAgT2JqZWN0M0QsXG4gIE9ydGhvZ3JhcGhpY0NhbWVyYSxcbiAgUGVyc3BlY3RpdmVDYW1lcmEsXG4gIFJheWNhc3RlcixcbiAgVmVjdG9yMixcbiAgVmVjdG9yM1xufSBmcm9tICd0aHJlZSc7XG5pbXBvcnQgeyBSQVlDQVNURVIgfSBmcm9tICcuLi8uLi9ldmVudHMvcmF5Y2FzdGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgVGhHcm91cCwgVGhPYmplY3QzRCB9IGZyb20gJy4uLy4uL2dlbmVyYXRlZCc7XG5pbXBvcnQgeyBUaENhbnZhcyB9IGZyb20gJy4uLy4uL1RoQ2FudmFzJztcbmltcG9ydCB7IFRoVmlldyB9IGZyb20gJy4uLy4uL1RoVmlldyc7XG5pbXBvcnQgeyBOZ0NoYW5nZXMgfSBmcm9tICcuLi8uLi91dGlsJztcblxuY29uc3QgdjEgPSBuZXcgVmVjdG9yMygpO1xuY29uc3QgdjIgPSBuZXcgVmVjdG9yMygpO1xuY29uc3QgdjMgPSBuZXcgVmVjdG9yMygpO1xuXG5mdW5jdGlvbiBkZWZhdWx0Q2FsY3VsYXRlUG9zaXRpb24oZWw6IE9iamVjdDNELCBjYW1lcmE6IENhbWVyYSwgc2l6ZTogeyB3aWR0aDogbnVtYmVyOyBoZWlnaHQ6IG51bWJlciB9KSB7XG4gIGNvbnN0IG9iamVjdFBvcyA9IHYxLnNldEZyb21NYXRyaXhQb3NpdGlvbihlbC5tYXRyaXhXb3JsZCk7XG4gIG9iamVjdFBvcy5wcm9qZWN0KGNhbWVyYSk7XG4gIGNvbnN0IHdpZHRoSGFsZiA9IHNpemUud2lkdGggLyAyO1xuICBjb25zdCBoZWlnaHRIYWxmID0gc2l6ZS5oZWlnaHQgLyAyO1xuICByZXR1cm4gW29iamVjdFBvcy54ICogd2lkdGhIYWxmICsgd2lkdGhIYWxmLCAtKG9iamVjdFBvcy55ICogaGVpZ2h0SGFsZikgKyBoZWlnaHRIYWxmXTtcbn1cblxuZXhwb3J0IHR5cGUgQ2FsY3VsYXRlUG9zaXRpb24gPSB0eXBlb2YgZGVmYXVsdENhbGN1bGF0ZVBvc2l0aW9uO1xuXG5mdW5jdGlvbiBpc09iamVjdEJlaGluZENhbWVyYShlbDogT2JqZWN0M0QsIGNhbWVyYTogQ2FtZXJhKSB7XG4gIGNvbnN0IG9iamVjdFBvcyA9IHYxLnNldEZyb21NYXRyaXhQb3NpdGlvbihlbC5tYXRyaXhXb3JsZCk7XG4gIGNvbnN0IGNhbWVyYVBvcyA9IHYyLnNldEZyb21NYXRyaXhQb3NpdGlvbihjYW1lcmEubWF0cml4V29ybGQpO1xuICBjb25zdCBkZWx0YUNhbU9iaiA9IG9iamVjdFBvcy5zdWIoY2FtZXJhUG9zKTtcbiAgY29uc3QgY2FtRGlyID0gY2FtZXJhLmdldFdvcmxkRGlyZWN0aW9uKHYzKTtcbiAgcmV0dXJuIGRlbHRhQ2FtT2JqLmFuZ2xlVG8oY2FtRGlyKSA+IE1hdGguUEkgLyAyO1xufVxuXG5mdW5jdGlvbiBpc09iamVjdFZpc2libGUoZWw6IE9iamVjdDNELCBjYW1lcmE6IENhbWVyYSwgcmF5Y2FzdGVyOiBSYXljYXN0ZXIsIG9jY2x1ZGU6IE9iamVjdDNEW10pIHtcbiAgY29uc3QgZWxQb3MgPSB2MS5zZXRGcm9tTWF0cml4UG9zaXRpb24oZWwubWF0cml4V29ybGQpO1xuICBjb25zdCBzY3JlZW5Qb3MgPSBlbFBvcy5jbG9uZSgpO1xuICBzY3JlZW5Qb3MucHJvamVjdChjYW1lcmEpO1xuICByYXljYXN0ZXIuc2V0RnJvbUNhbWVyYShzY3JlZW5Qb3MgYXMgdW5rbm93biBhcyBWZWN0b3IyLCBjYW1lcmEpO1xuICBjb25zdCBpbnRlcnNlY3RzID0gcmF5Y2FzdGVyLmludGVyc2VjdE9iamVjdHMob2NjbHVkZSwgdHJ1ZSk7XG4gIGlmIChpbnRlcnNlY3RzLmxlbmd0aCkge1xuICAgIGNvbnN0IGludGVyc2VjdGlvbkRpc3RhbmNlID0gaW50ZXJzZWN0c1swXS5kaXN0YW5jZTtcbiAgICBjb25zdCBwb2ludERpc3RhbmNlID0gZWxQb3MuZGlzdGFuY2VUbyhyYXljYXN0ZXIucmF5Lm9yaWdpbik7XG4gICAgcmV0dXJuIHBvaW50RGlzdGFuY2UgPCBpbnRlcnNlY3Rpb25EaXN0YW5jZTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gb2JqZWN0U2NhbGUoZWw6IE9iamVjdDNELCBjYW1lcmE6IENhbWVyYSkge1xuICBpZiAoY2FtZXJhIGluc3RhbmNlb2YgT3J0aG9ncmFwaGljQ2FtZXJhKSB7XG4gICAgcmV0dXJuIGNhbWVyYS56b29tO1xuICB9IGVsc2UgaWYgKGNhbWVyYSBpbnN0YW5jZW9mIFBlcnNwZWN0aXZlQ2FtZXJhKSB7XG4gICAgY29uc3Qgb2JqZWN0UG9zID0gdjEuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKGVsLm1hdHJpeFdvcmxkKTtcbiAgICBjb25zdCBjYW1lcmFQb3MgPSB2Mi5zZXRGcm9tTWF0cml4UG9zaXRpb24oY2FtZXJhLm1hdHJpeFdvcmxkKTtcbiAgICBjb25zdCB2Rk9WID0gKGNhbWVyYS5mb3YgKiBNYXRoLlBJKSAvIDE4MDtcbiAgICBjb25zdCBkaXN0ID0gb2JqZWN0UG9zLmRpc3RhbmNlVG8oY2FtZXJhUG9zKTtcbiAgICBjb25zdCBzY2FsZUZPViA9IDIgKiBNYXRoLnRhbih2Rk9WIC8gMikgKiBkaXN0O1xuICAgIHJldHVybiAxIC8gc2NhbGVGT1Y7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIDE7XG4gIH1cbn1cblxuZnVuY3Rpb24gb2JqZWN0WkluZGV4KGVsOiBPYmplY3QzRCwgY2FtZXJhOiBDYW1lcmEsIHpJbmRleFJhbmdlOiBBcnJheTxudW1iZXI+KSB7XG4gIGlmIChjYW1lcmEgaW5zdGFuY2VvZiBQZXJzcGVjdGl2ZUNhbWVyYSB8fCBjYW1lcmEgaW5zdGFuY2VvZiBPcnRob2dyYXBoaWNDYW1lcmEpIHtcbiAgICBjb25zdCBvYmplY3RQb3MgPSB2MS5zZXRGcm9tTWF0cml4UG9zaXRpb24oZWwubWF0cml4V29ybGQpO1xuICAgIGNvbnN0IGNhbWVyYVBvcyA9IHYyLnNldEZyb21NYXRyaXhQb3NpdGlvbihjYW1lcmEubWF0cml4V29ybGQpO1xuICAgIGNvbnN0IGRpc3QgPSBvYmplY3RQb3MuZGlzdGFuY2VUbyhjYW1lcmFQb3MpO1xuICAgIGNvbnN0IEEgPSAoekluZGV4UmFuZ2VbMV0gLSB6SW5kZXhSYW5nZVswXSkgLyAoY2FtZXJhLmZhciAtIGNhbWVyYS5uZWFyKTtcbiAgICBjb25zdCBCID0gekluZGV4UmFuZ2VbMV0gLSBBICogY2FtZXJhLmZhcjtcbiAgICByZXR1cm4gTWF0aC5yb3VuZChBICogZGlzdCArIEIpO1xuICB9XG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbmNvbnN0IGVwc2lsb24gPSAodmFsdWU6IG51bWJlcikgPT4gKE1hdGguYWJzKHZhbHVlKSA8IDFlLTEwID8gMCA6IHZhbHVlKTtcblxuZnVuY3Rpb24gZ2V0Q1NTTWF0cml4KG1hdHJpeDogTWF0cml4NCwgbXVsdGlwbGllcnM6IG51bWJlcltdLCBwcmVwZW5kID0gJycpIHtcbiAgbGV0IG1hdHJpeDNkID0gJ21hdHJpeDNkKCc7XG4gIGZvciAobGV0IGkgPSAwOyBpICE9PSAxNjsgaSsrKSB7XG4gICAgbWF0cml4M2QgKz0gZXBzaWxvbihtdWx0aXBsaWVyc1tpXSAqIG1hdHJpeC5lbGVtZW50c1tpXSkgKyAoaSAhPT0gMTUgPyAnLCcgOiAnKScpO1xuICB9XG4gIHJldHVybiBwcmVwZW5kICsgbWF0cml4M2Q7XG59XG5cbmNvbnN0IGdldENhbWVyYUNTU01hdHJpeCA9IChcbiAgKG11bHRpcGxpZXJzOiBudW1iZXJbXSkgPT4gKG1hdHJpeDogTWF0cml4NCkgPT5cbiAgICBnZXRDU1NNYXRyaXgobWF0cml4LCBtdWx0aXBsaWVycylcbikoWzEsIC0xLCAxLCAxLCAxLCAtMSwgMSwgMSwgMSwgLTEsIDEsIDEsIDEsIC0xLCAxLCAxXSk7XG5cbmNvbnN0IGdldE9iamVjdENTU01hdHJpeCA9IChcbiAgKHNjYWxlTXVsdGlwbGllcnM6IChuOiBudW1iZXIpID0+IG51bWJlcltdKSA9PiAobWF0cml4OiBNYXRyaXg0LCBmYWN0b3I6IG51bWJlcikgPT5cbiAgICBnZXRDU1NNYXRyaXgobWF0cml4LCBzY2FsZU11bHRpcGxpZXJzKGZhY3RvciksICd0cmFuc2xhdGUoLTUwJSwtNTAlKScpXG4pKChmOiBudW1iZXIpID0+IFsxIC8gZiwgMSAvIGYsIDEgLyBmLCAxLCAtMSAvIGYsIC0xIC8gZiwgLTEgLyBmLCAtMSwgMSAvIGYsIDEgLyBmLCAxIC8gZiwgMSwgMSwgMSwgMSwgMV0pO1xuXG50eXBlIFBvaW50ZXJFdmVudHNQcm9wZXJ0aWVzID1cbiAgfCAnYXV0bydcbiAgfCAnbm9uZSdcbiAgfCAndmlzaWJsZVBhaW50ZWQnXG4gIHwgJ3Zpc2libGVGaWxsJ1xuICB8ICd2aXNpYmxlU3Ryb2tlJ1xuICB8ICd2aXNpYmxlJ1xuICB8ICdwYWludGVkJ1xuICB8ICdmaWxsJ1xuICB8ICdzdHJva2UnXG4gIHwgJ2FsbCdcbiAgfCAnaW5oZXJpdCc7XG5cbi8qKlxuICogQSBwb3J0IG9mIHRoZSBwbW5kcnMvZHJlaSBIdG1sIGNvbXBvbmVudFxuICpcbiAqIEFkZCBIdG1sIGNvbnRlbnQgdG8gYW55IHRocmVlLmpzIG9iamVjdDNkIG5vZGVcbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAndGgtaHRtbCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9odG1sLmNvbXBvbmVudC5odG1sJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgSHRtbENvbXBvbmVudCBleHRlbmRzIFRoR3JvdXA8R3JvdXA+IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3SW5pdCB7XG4gIEBJbnB1dCgpIHByZXBlbmQgPSBmYWxzZTsgLy8gUHJvamVjdCBjb250ZW50IGJlaGluZCB0aGUgY2FudmFzIChkZWZhdWx0OiBmYWxzZSlcbiAgQElucHV0KCkgY2VudGVyID0gZmFsc2U7IC8vIEFkZHMgYSAtNTAlLy01MCUgY3NzIHRyYW5zZm9ybSAoZGVmYXVsdDogZmFsc2UpIFtpZ25vcmVkIGluIHRyYW5zZm9ybSBtb2RlXVxuICBASW5wdXQoKSBmdWxsc2NyZWVuID0gZmFsc2U7IC8vIEFsaWducyB0byB0aGUgdXBwZXItbGVmdCBjb3JuZXIsIGZpbGxzIHRoZSBzY3JlZW4gKGRlZmF1bHQ6ZmFsc2UpIFtpZ25vcmVkIGluIHRyYW5zZm9ybSBtb2RlXVxuICBlcHMgPSAwLjAwMTtcbiAgQElucHV0KCkgcG9ydGFsPzogSFRNTEVsZW1lbnQ7IC8vIFJlZmVyZW5jZSB0byB0YXJnZXQgY29udGFpbmVyIChkZWZhdWx0PXVuZGVmaW5lZClcbiAgLyogSWYgc2V0IChkZWZhdWx0OiB1bmRlZmluZWQpLCBjaGlsZHJlbiB3aWxsIGJlIHNjYWxlZCBieVxuICAgKiB0aGlzIGZhY3RvciwgYW5kIGFsc28gYnkgZGlzdGFuY2UgdG8gYSBQZXJzcGVjdGl2ZUNhbWVyYSAvIHpvb20gYnkgYSBPcnRob2dyYXBoaWNDYW1lcmEuXG4gICAqL1xuICBASW5wdXQoKSBkaXN0YW5jZUZhY3Rvcj86IG51bWJlcjtcbiAgQElucHV0KCkgc3ByaXRlID0gZmFsc2U7IC8vIFJlbmRlcnMgYXMgc3ByaXRlLCBidXQgb25seSBpbiB0cmFuc2Zvcm0gbW9kZSAoZGVmYXVsdD1mYWxzZSlcbiAgQElucHV0KCkgdHJhbnNmb3JtID0gZmFsc2U7IC8vIElmIHRydWUsIGFwcGxpZXMgbWF0cml4M2QgdHJhbnNmb3JtYXRpb25zIChkZWZhdWx0PWZhbHNlKVxuICBASW5wdXQoKSB6SW5kZXhSYW5nZTogW251bWJlciwgbnVtYmVyXSA9IFsxNjc3NzI3MSwgMF07IC8vIFotb3JkZXIgcmFuZ2UgKGRlZmF1bHQ9WzE2Nzc3MjcxLCAwXSlcblxuICBASW5wdXQoKSBzdHlsZT86IFBhcnRpYWw8Q1NTU3R5bGVEZWNsYXJhdGlvbj47XG4gIEBJbnB1dCgpIGNsYXNzTmFtZT86IHN0cmluZztcblxuICAvKipcbiAgICogQ2FuIGJlIHRydWUgb3IgYSBPYmplY3QzRD5bXXxUaE9iamVjdDNEW10sIHRydWUgb2NjbHVkZXMgdGhlIGVudGlyZSBzY2VuZSAoZGVmYXVsdDogdW5kZWZpbmVkKVxuICAgKi9cbiAgQElucHV0KCkgb2NjbHVkZT86IE9iamVjdDNEW10gfCBUaE9iamVjdDNEW10gfCBib29sZWFuO1xuICBAT3V0cHV0KClcbiAgcHVibGljIG9uT2NjbHVkZSA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcblxuICAvKipcbiAgICogT3ZlcnJpZGUgZGVmYXVsdCBwb3NpdGlvbmluZyBmdW5jdGlvbi4gW2lnbm9yZWQgaW4gdHJhbnNmb3JtIG1vZGVdXG4gICAqL1xuICBASW5wdXQoKSBjYWxjdWxhdGVQb3NpdGlvbjogQ2FsY3VsYXRlUG9zaXRpb24gPSBkZWZhdWx0Q2FsY3VsYXRlUG9zaXRpb247XG4gIEBJbnB1dCgpIGFzID0gJ2Rpdic7IC8vIFdyYXBwaW5nIGVsZW1lbnQgKGRlZmF1bHQ6ICdkaXYnKVxuICBASW5wdXQoKSB3cmFwcGVyQ2xhc3M/OiBzdHJpbmc7IC8vIFRoZSBjbGFzc05hbWUgb2YgdGhlIHdyYXBwaW5nIGVsZW1lbnQgKGRlZmF1bHQ6IHVuZGVmaW5lZClcbiAgQElucHV0KCkgcG9pbnRlckV2ZW50czogUG9pbnRlckV2ZW50c1Byb3BlcnRpZXMgPSAnYXV0byc7XG5cbiAgcHJvdGVjdGVkIHRyYW5zZm9ybUlubmVyU3R5bGVzID0gdGhpcy5jb21wdXRlSW5uZXJTdHlsZXMoKTtcbiAgcHJvdGVjdGVkIHN0eWxlczogUmVjb3JkPHN0cmluZywgYW55PiB8IG51bGwgPSBudWxsO1xuXG4gIHByaXZhdGUgb2xkWm9vbSA9IDA7XG4gIHByaXZhdGUgb2xkUG9zaXRpb24gPSBbMCwgMF07XG4gIHByaXZhdGUgbm90T2NjbHVkZWQgPSB0cnVlO1xuXG4gIEBWaWV3Q2hpbGQoJ291dGVyUmVmJylcbiAgcHJpdmF0ZSB0cmFuc2Zvcm1PdXRlclJlZj86IEVsZW1lbnRSZWY8SFRNTERpdkVsZW1lbnQ+O1xuICBAVmlld0NoaWxkKCdpbm5lclJlZicpXG4gIHByaXZhdGUgdHJhbnNmb3JtSW5uZXJSZWY/OiBFbGVtZW50UmVmPEhUTUxEaXZFbGVtZW50PjtcbiAgcHJpdmF0ZSBlbD86IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHRhcmdldD86IEhUTUxFbGVtZW50IHwgbnVsbDtcbiAgcHJpdmF0ZSBmcmFtZVN1YnNjcmlwdGlvbj86IFN1YnNjcmlwdGlvbjtcbiAgcHJpdmF0ZSByYXljYXN0ZXIgPSBpbmplY3QoUkFZQ0FTVEVSKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHZpZXc6IFRoVmlldywgcHJpdmF0ZSBjYW52YXM6IFRoQ2FudmFzLCBAU2tpcFNlbGYoKSBwYXJlbnQ6IFRoT2JqZWN0M0QpIHtcbiAgICBzdXBlcihwYXJlbnQpO1xuICB9XG5cbiAgcHVibGljIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHN1cGVyLm5nT25Jbml0KCk7XG4gICAgdGhpcy5zdHlsZXMgPSB0aGlzLmNvbXB1dGVTdHlsZXMoKTtcbiAgfVxuXG4gIHB1YmxpYyBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5lbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGhpcy5hcyk7XG4gICAgdGhpcy5mcmFtZVN1YnNjcmlwdGlvbiA9IHRoaXMudmlldy5vblJlbmRlci5zdWJzY3JpYmUoKCkgPT4gdGhpcy5vbkZyYW1lKCkpO1xuICAgIGlmICh0aGlzLnRyYW5zZm9ybU91dGVyUmVmKSB7XG4gICAgICB0aGlzLmVsLmFwcGVuZENoaWxkKHRoaXMudHJhbnNmb3JtT3V0ZXJSZWYubmF0aXZlRWxlbWVudCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmVsICYmICF0aGlzLnRhcmdldCkge1xuICAgICAgdGhpcy5hcHBlbmRFbGVtZW50KHRoaXMuZWwpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBvblJlc2l6ZSgpIHtcbiAgICB0aGlzLnN0eWxlcyA9IHRoaXMuY29tcHV0ZVN0eWxlcygpO1xuICB9XG5cbiAgcHVibGljIG5nT25DaGFuZ2VzKGNoYW5nZXM6IE5nQ2hhbmdlczxIdG1sQ29tcG9uZW50Pik6IHZvaWQge1xuICAgIHN1cGVyLm5nT25DaGFuZ2VzKGNoYW5nZXMpO1xuICAgIC8qXG4gICAgaWYodGhpcy5lbCkge1xuICAgICAgaWYoY2hhbmdlcy5wb3J0YWwgfHwgY2hhbmdlcy50cmFuc2Zvcm0pIHtcbiAgICAgICAgdGhpcy5hcHBlbmRFbGVtZW50KHRoaXMuZWwpO1xuICAgICAgfVxuXG4gICAgICBpZihjaGFuZ2VzLndyYXBwZXJDbGFzcykge1xuICAgICAgICB0aGlzLmVsLmNsYXNzTmFtZSA9IGNoYW5nZXMud3JhcHBlckNsYXNzLmN1cnJlbnRWYWx1ZSA/PyAnJztcbiAgICAgIH1cblxuICAgICAgaWYoY2hhbmdlcy5wb2ludGVyRXZlbnRzKSB7XG4gICAgICAgIHRoaXMudHJhbnNmb3JtSW5uZXJTdHlsZXMgPSB0aGlzLmNvbXB1dGVJbm5lclN0eWxlcygpO1xuICAgICAgfVxuICAgIH1cbiAgICAqL1xuICB9XG5cbiAgcHJpdmF0ZSBhcHBlbmRFbGVtZW50KGVsOiBIVE1MRWxlbWVudCkge1xuICAgIGlmICghdGhpcy5lbCB8fCAhdGhpcy5vYmpSZWYgfHwgIXRoaXMuY2FudmFzLnJlbmRlcmVyQ2FudmFzIHx8ICF0aGlzLnZpZXcuY2FtZXJhKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMudGFyZ2V0ID0gdGhpcy5wb3J0YWwgPz8gdGhpcy5jYW52YXMucmVuZGVyZXJDYW52YXM/Lm5hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICB0aGlzLnZpZXcuc2NlbmU/Lm9ialJlZj8udXBkYXRlTWF0cml4V29ybGQoKTtcbiAgICBpZiAodGhpcy50cmFuc2Zvcm0pIHtcbiAgICAgIGVsLnN0eWxlLmNzc1RleHQgPSAncG9zaXRpb246YWJzb2x1dGU7dG9wOjA7bGVmdDowO3BvaW50ZXItZXZlbnRzOm5vbmU7b3ZlcmZsb3c6aGlkZGVuOyc7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHZlYyA9IHRoaXMuY2FsY3VsYXRlUG9zaXRpb24odGhpcy5vYmpSZWYsIHRoaXMudmlldy5jYW1lcmEub2JqUmVmIGFzIENhbWVyYSwgdGhpcy5nZXRTaXplKCkpO1xuICAgICAgZWwuc3R5bGUuY3NzVGV4dCA9IGBwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7dHJhbnNmb3JtOnRyYW5zbGF0ZTNkKCR7dmVjWzBdfXB4LCR7dmVjWzFdfXB4LDApO3RyYW5zZm9ybS1vcmlnaW46MCAwO2A7XG4gICAgfVxuICAgIGlmICh0aGlzLnRhcmdldCkge1xuICAgICAgaWYgKHRoaXMucHJlcGVuZCkge1xuICAgICAgICB0aGlzLnRhcmdldC5wcmVwZW5kKGVsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMudGFyZ2V0LmFwcGVuZENoaWxkKGVsKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwdWJsaWMgb25GcmFtZSgpIHtcbiAgICBjb25zdCBjYW1lcmEgPSB0aGlzLnZpZXcuY2FtZXJhPy5vYmpSZWYgYXMgUGVyc3BlY3RpdmVDYW1lcmEgfCBPcnRob2dyYXBoaWNDYW1lcmEgfCB1bmRlZmluZWQ7XG4gICAgY29uc3Qgc2NlbmUgPSB0aGlzLnZpZXcuc2NlbmU/Lm9ialJlZjtcbiAgICBjb25zdCBncm91cCA9IHRoaXMuX29ialJlZjtcbiAgICBjb25zdCBzaXplID0gdGhpcy5nZXRTaXplKCk7XG4gICAgaWYgKCFjYW1lcmEgfHwgIWdyb3VwIHx8ICFzY2VuZSB8fCAhdGhpcy5lbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCgpO1xuICAgIGdyb3VwLnVwZGF0ZVdvcmxkTWF0cml4KHRydWUsIGZhbHNlKTtcbiAgICBjb25zdCB2ZWMgPSB0aGlzLnRyYW5zZm9ybSA/IHRoaXMub2xkUG9zaXRpb24gOiB0aGlzLmNhbGN1bGF0ZVBvc2l0aW9uKGdyb3VwLCBjYW1lcmEsIHNpemUpO1xuXG4gICAgaWYgKFxuICAgICAgdGhpcy50cmFuc2Zvcm0gfHxcbiAgICAgIE1hdGguYWJzKHRoaXMub2xkWm9vbSAtIGNhbWVyYS56b29tKSA+IHRoaXMuZXBzIHx8XG4gICAgICBNYXRoLmFicyh0aGlzLm9sZFBvc2l0aW9uWzBdIC0gdmVjWzBdKSA+IHRoaXMuZXBzIHx8XG4gICAgICBNYXRoLmFicyh0aGlzLm9sZFBvc2l0aW9uWzFdIC0gdmVjWzFdKSA+IHRoaXMuZXBzXG4gICAgKSB7XG4gICAgICBjb25zdCBpc0JlaGluZENhbWVyYSA9IGlzT2JqZWN0QmVoaW5kQ2FtZXJhKGdyb3VwLCBjYW1lcmEpO1xuICAgICAgbGV0IHJheXRyYWNlVGFyZ2V0OiBudWxsIHwgdW5kZWZpbmVkIHwgYm9vbGVhbiB8IE9iamVjdDNEW10gPSBmYWxzZTtcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5vY2NsdWRlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgaWYgKHRoaXMub2NjbHVkZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgIHJheXRyYWNlVGFyZ2V0ID0gW3NjZW5lXTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHRoaXMub2NjbHVkZSkpIHtcbiAgICAgICAgcmF5dHJhY2VUYXJnZXQgPSB0aGlzLm9jY2x1ZGUubWFwKChpdGVtKSA9PiAoaXRlbSBhcyBQYXJ0aWFsPFRoT2JqZWN0M0Q+KS5vYmpSZWYgPz8gaXRlbSkgYXMgT2JqZWN0M0RbXTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcHJldmlvdXNseVZpc2libGUgPSB0aGlzLm5vdE9jY2x1ZGVkO1xuICAgICAgaWYgKHJheXRyYWNlVGFyZ2V0KSB7XG4gICAgICAgIHRoaXMubm90T2NjbHVkZWQgPSAhaXNCZWhpbmRDYW1lcmEgJiYgaXNPYmplY3RWaXNpYmxlKGdyb3VwLCBjYW1lcmEsIHRoaXMucmF5Y2FzdGVyLCByYXl0cmFjZVRhcmdldCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm5vdE9jY2x1ZGVkID0gIWlzQmVoaW5kQ2FtZXJhO1xuICAgICAgfVxuXG4gICAgICBpZiAocHJldmlvdXNseVZpc2libGUgIT09IHRoaXMubm90T2NjbHVkZWQpIHtcbiAgICAgICAgaWYgKHRoaXMub25PY2NsdWRlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB0aGlzLm9uT2NjbHVkZS5uZXh0KCF0aGlzLm5vdE9jY2x1ZGVkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmVsLnN0eWxlLmRpc3BsYXkgPSB0aGlzLm5vdE9jY2x1ZGVkID8gJ2Jsb2NrJyA6ICdub25lJztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLmVsLnN0eWxlLnpJbmRleCA9IGAke29iamVjdFpJbmRleChncm91cCwgY2FtZXJhLCB0aGlzLnpJbmRleFJhbmdlKX1gO1xuICAgICAgaWYgKHRoaXMudHJhbnNmb3JtKSB7XG4gICAgICAgIGNvbnN0IFt3aWR0aEhhbGYsIGhlaWdodEhhbGZdID0gW3NpemUud2lkdGggLyAyLCBzaXplLmhlaWdodCAvIDJdO1xuICAgICAgICBjb25zdCBmb3YgPSBjYW1lcmEucHJvamVjdGlvbk1hdHJpeC5lbGVtZW50c1s1XSAqIGhlaWdodEhhbGY7XG4gICAgICAgIGNvbnN0IHsgaXNPcnRob2dyYXBoaWNDYW1lcmEsIHRvcCwgbGVmdCwgYm90dG9tLCByaWdodCB9ID0gY2FtZXJhIGFzIE9ydGhvZ3JhcGhpY0NhbWVyYTtcbiAgICAgICAgY29uc3QgY2FtZXJhTWF0cml4ID0gZ2V0Q2FtZXJhQ1NTTWF0cml4KGNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UpO1xuICAgICAgICBjb25zdCBjYW1lcmFUcmFuc2Zvcm0gPSBpc09ydGhvZ3JhcGhpY0NhbWVyYVxuICAgICAgICAgID8gYHNjYWxlKCR7Zm92fSl0cmFuc2xhdGUoJHtlcHNpbG9uKC0ocmlnaHQgKyBsZWZ0KSAvIDIpfXB4LCR7ZXBzaWxvbigodG9wICsgYm90dG9tKSAvIDIpfXB4KWBcbiAgICAgICAgICA6IGB0cmFuc2xhdGVaKCR7Zm92fXB4KWA7XG4gICAgICAgIGxldCBtYXRyaXggPSBncm91cC5tYXRyaXhXb3JsZDtcbiAgICAgICAgaWYgKHRoaXMuc3ByaXRlKSB7XG4gICAgICAgICAgbWF0cml4ID0gY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZS5jbG9uZSgpLnRyYW5zcG9zZSgpLmNvcHlQb3NpdGlvbihtYXRyaXgpLnNjYWxlKGdyb3VwLnNjYWxlKTtcbiAgICAgICAgICBtYXRyaXguZWxlbWVudHNbM10gPSBtYXRyaXguZWxlbWVudHNbN10gPSBtYXRyaXguZWxlbWVudHNbMTFdID0gMDtcbiAgICAgICAgICBtYXRyaXguZWxlbWVudHNbMTVdID0gMTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVsLnN0eWxlLndpZHRoID0gc2l6ZS53aWR0aCArICdweCc7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUuaGVpZ2h0ID0gc2l6ZS5oZWlnaHQgKyAncHgnO1xuICAgICAgICB0aGlzLmVsLnN0eWxlLnBlcnNwZWN0aXZlID0gaXNPcnRob2dyYXBoaWNDYW1lcmEgPyAnJyA6IGAke2Zvdn1weGA7XG4gICAgICAgIGlmICh0aGlzLnRyYW5zZm9ybU91dGVyUmVmICYmIHRoaXMudHJhbnNmb3JtSW5uZXJSZWYpIHtcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LWxlblxuICAgICAgICAgIHRoaXMudHJhbnNmb3JtT3V0ZXJSZWYubmF0aXZlRWxlbWVudC5zdHlsZS50cmFuc2Zvcm0gPSBgJHtjYW1lcmFUcmFuc2Zvcm19JHtjYW1lcmFNYXRyaXh9dHJhbnNsYXRlKCR7d2lkdGhIYWxmfXB4LCR7aGVpZ2h0SGFsZn1weClgO1xuICAgICAgICAgIHRoaXMudHJhbnNmb3JtSW5uZXJSZWYubmF0aXZlRWxlbWVudC5zdHlsZS50cmFuc2Zvcm0gPSBnZXRPYmplY3RDU1NNYXRyaXgoXG4gICAgICAgICAgICBtYXRyaXgsXG4gICAgICAgICAgICAxIC8gKCh0aGlzLmRpc3RhbmNlRmFjdG9yIHx8IDEwKSAvIDQwMClcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBzY2FsZSA9IHRoaXMuZGlzdGFuY2VGYWN0b3IgPT09IHVuZGVmaW5lZCA/IDEgOiBvYmplY3RTY2FsZShncm91cCwgY2FtZXJhKSAqIHRoaXMuZGlzdGFuY2VGYWN0b3I7XG4gICAgICAgIHRoaXMuZWwuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZTNkKCR7dmVjWzBdfXB4LCR7dmVjWzFdfXB4LDApIHNjYWxlKCR7c2NhbGV9KWA7XG4gICAgICB9XG4gICAgICB0aGlzLm9sZFBvc2l0aW9uID0gdmVjO1xuICAgICAgdGhpcy5vbGRab29tID0gY2FtZXJhLnpvb207XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5lbD8ucmVtb3ZlKCk7XG4gICAgdGhpcy5mcmFtZVN1YnNjcmlwdGlvbj8udW5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIHByaXZhdGUgY29tcHV0ZVN0eWxlcygpIHtcbiAgICBjb25zdCBzaXplID0gdGhpcy5nZXRTaXplKCk7XG4gICAgaWYgKHRoaXMudHJhbnNmb3JtKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgdG9wOiAwLFxuICAgICAgICBsZWZ0OiAwLFxuICAgICAgICB3aWR0aDogc2l6ZS53aWR0aCArICdweCcsXG4gICAgICAgIGhlaWdodDogc2l6ZS5oZWlnaHQgKyAncHgnLFxuICAgICAgICB0cmFuc2Zvcm1TdHlsZTogJ3ByZXNlcnZlLTNkJyxcbiAgICAgICAgcG9pbnRlckV2ZW50czogJ25vbmUnXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgdHJhbnNmb3JtOiB0aGlzLmNlbnRlciA/ICd0cmFuc2xhdGUzZCgtNTAlLC01MCUsMCknIDogJ25vbmUnLFxuICAgICAgICAuLi4odGhpcy5mdWxsc2NyZWVuICYmIHtcbiAgICAgICAgICB0b3A6IC1zaXplLmhlaWdodCAvIDIgKyAncHgnLFxuICAgICAgICAgIGxlZnQ6IC1zaXplLndpZHRoIC8gMiArICdweCcsXG4gICAgICAgICAgd2lkdGg6IHNpemUud2lkdGggKyAncHgnLFxuICAgICAgICAgIGhlaWdodDogc2l6ZS5oZWlnaHQgKyAncHgnXG4gICAgICAgIH0pLFxuICAgICAgICAuLi50aGlzLnN0eWxlXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY29tcHV0ZUlubmVyU3R5bGVzKCkge1xuICAgIHJldHVybiB7IHBvc2l0aW9uOiAnYWJzb2x1dGUnLCBwb2ludGVyRXZlbnRzOiB0aGlzLnBvaW50ZXJFdmVudHMgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U2l6ZSgpIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy52aWV3LnZpZXdQb3J0ID8/IHRoaXMuY2FudmFzLnJlbmRlcmVyQ2FudmFzPy5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpID8/IHsgd2lkdGg6IDAsIGhlaWdodDogMCB9XG4gICAgKTtcbiAgfVxufVxuIiwiPGRpdiBbbmdTdHlsZV09XCJzdHlsZXNcIiAjb3V0ZXJSZWYgKm5nSWY9XCJ0cmFuc2Zvcm07ICBlbHNlIG5vVHJhbnNmb3JtXCIgKG9uUmVzaXplKT1cIm9uUmVzaXplKClcIj5cbiAgICA8ZGl2ICNpbm5lclJlZiBbbmdTdHlsZV09XCJ0cmFuc2Zvcm1Jbm5lclN0eWxlc1wiID5cbiAgICAgICAgPGRpdiBbc3R5bGVdPVwic3R5bGVcIiBbY2xhc3NOYW1lXT1cImNsYXNzTmFtZVwiPlxuICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cInRlbXBPdXRsZXRcIiA+PC9uZy1jb250YWluZXI+XG4gICAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuPC9kaXY+XG48bmctdGVtcGxhdGUgI25vVHJhbnNmb3JtPlxuICAgIDxkaXYgW25nU3R5bGVdPVwic3R5bGVzXCIgW2NsYXNzTmFtZV09XCJjbGFzc05hbWVcIiAjb3V0ZXJSZWY+XG4gICAgICAgIDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJ0ZW1wT3V0bGV0XCIgPjwvbmctY29udGFpbmVyPlxuICAgIDwvZGl2PlxuPC9uZy10ZW1wbGF0ZT5cblxuPG5nLXRlbXBsYXRlICN0ZW1wT3V0bGV0PlxuICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cbjwvbmctdGVtcGxhdGU+XG4iXX0=